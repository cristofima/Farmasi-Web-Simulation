<p-confirmDialog [style]="{width: '30vw'}" rejectButtonStyleClass="p-button-outlined"></p-confirmDialog>
<br />
<p-button (click)="showDialog()" label="Añadir miembro"></p-button>
<br />
<div class="card">
  <div class="flex flex-column md:flex-row gap-5">
    <div class="flex-auto overflow-x-auto">
      <p-organizationChart [value]="data">
        <ng-template let-node pTemplate="person">
          <div class="flex  flex-wrap gap-3 justify-content-center">
            <button pButton icon="pi pi-folder" (click)="loadDetailsDialog(node)" title="Ver más detalles"
              class="p-button-rounded p-button-secondary p-button-small"></button>
            <button *ngIf="node.data.parentId" pButton icon="pi pi-pencil" (click)="loadEditDialog(node)" title="Editar"
              class="p-button-rounded p-button-small"></button>
            <button *ngIf="node.data.parentId" pButton icon="pi pi-trash" (click)="deleteTeamMember(node)"
              title="Eliminar" class="p-button-rounded p-button-danger p-button-small"></button>
          </div>
          <div class="text-center">
            <div class="font-bold">{{ node.data.name }}</div>
            <div>{{ node.data.title }} {{ node.data.bonification }}%</div>
            <p><b>VP:</b> {{ node.data.pv }}</p>
            <p><b>VG:</b> {{ node.data.gv }}</p>
          </div>
        </ng-template>
      </p-organizationChart>
    </div>
  </div>
</div>

<p-dialog header="Nuevo miembro" [(visible)]="visible" [style]="{width: '30vw'}" [modal]="true" [draggable]="false">
  <div class="card flex flex-wrap gap-3 p-fluid">
    <div class="flex flex-column gap-2">
      <label for="name">Nombre</label>
      <input pInputText id="name" [(ngModel)]="name" />
      <label for="personalVolume">VP</label>
      <p-inputNumber inputId="personalVolume" [(ngModel)]="personalVolume" [min]="0"> </p-inputNumber>
      <label for="parentId">Miembro padre</label>
      <p-dropdown [options]="members" [(ngModel)]="selectedParentId" placeholder="Seleccionar" id="parentId"
        [filter]="true" optionValue="id" optionLabel="name" filterBy="name" appendTo="body"></p-dropdown>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button (click)="addTeamMember()" label="Guardar"></p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Editar miembro" [(visible)]="showEditDialog" [style]="{width: '30vw'}" [modal]="true"
  [draggable]="false">
  <div class="card flex flex-wrap gap-3 p-fluid">
    <div class="flex flex-column gap-2">
      <label for="name">Nombre</label>
      <input pInputText id="name" [(ngModel)]="name" />
      <label for="personalVolume">VP</label>
      <p-inputNumber inputId="personalVolume" [(ngModel)]="personalVolume" [min]="0"> </p-inputNumber>
      <label for="parentId">Miembro padre</label>
      <p-dropdown [options]="members" [(ngModel)]="selectedParentId" placeholder="Seleccionar" id="parentId"
        [filter]="true" optionValue="id" optionLabel="name" filterBy="name" appendTo="body"></p-dropdown>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button (click)="editTeamMember()" label="Guardar"></p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Detalles de {{selectedTreeNode?.data?.name}}" [(visible)]="showDetailsDialog"
  [style]="{width: '30vw'}" [modal]="true" [draggable]="false">
  <div class="card flex flex-wrap gap-3 p-fluid">
    <p-card header="Equipo" *ngIf="selectedTreeNode">
      <p class="m-0">
        <b>Volumen Personal (VP):</b> {{selectedTreeNode.data.pv}}
      </p>
      <p class="m-0">
        <b>Volumen Grupal (VG):</b> {{selectedTreeNode.data.gv}}
      </p>
      <p class="m-0">
        <b>% Bonificación:</b> {{selectedTreeNode.data.bonification}} %
      </p>
      <p class="m-0">
        <b>Título:</b> {{selectedTreeNode.data.title}}
      </p>
      <p class="m-0" *ngIf="selectedTreeNode.data.sp">
        <b>Puntos Laterales:</b> {{selectedTreeNode.data.sp}}
      </p>
      <p class="m-0" *ngIf="selectedTreeNode.data.tp">
        <b>Puntos de Título:</b> {{selectedTreeNode.data.tp}}
      </p>
    </p-card>
    <p-card header="Bonos Mensuales ({{totalBonus | currency}})" *ngIf="monthlyBonusModel">
      <p class="m-0">
        <b>Bono Personal:</b> {{monthlyBonusModel.personalBonus | currency}}
      </p>
      <p class="m-0">
        <b>Bono de Grupo:</b> {{monthlyBonusModel.grupalBonus | currency}}
      </p>
      <p class="m-0" *ngIf="monthlyBonusModel.carBonus">
        <b>Bono de Auto:</b> {{monthlyBonusModel.carBonus | currency}}
      </p>
      <p class="m-0" *ngIf="totalLeadershipBonus">
        <b>Bono de Liderazgo:</b> {{totalLeadershipBonus | currency}}
      </p>
      <ul *ngIf="totalLeadershipBonus">
        <li *ngFor="let leadershipBonus of monthlyBonusModel.leadershipBonusArr; let i = index">
          <b>Gen {{i + 1}}:</b> {{leadershipBonus | currency}}
        </li>
      </ul>
    </p-card>
  </div>
</p-dialog>